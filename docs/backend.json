{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a student user of the StudyTrack Journal.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Activity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Activity",
      "type": "object",
      "description": "Represents a logged activity by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Activity entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Activity)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the activity occurred.",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "description": "Type of activity (e.g., 'study', 'class', 'break')."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the activity."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "type",
        "description"
      ]
    },
    "Problem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Problem",
      "type": "object",
      "description": "Represents a problem solved by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Problem entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Problem)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the problem was solved.",
          "format": "date-time"
        },
        "category": {
          "type": "string",
          "description": "Category of the problem (e.g., 'math', 'physics', 'chemistry')."
        },
        "response": {
          "type": "string",
          "description": "User's response or solution to the problem."
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "category",
        "response"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Only accessible by the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/activities/{activityId}",
        "definition": {
          "entityName": "Activity",
          "schema": {
            "$ref": "#/backend/entities/Activity"
          },
          "description": "Stores activities logged by the user. Only accessible by the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "activityId",
              "description": "The unique identifier of the activity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/problems/{problemId}",
        "definition": {
          "entityName": "Problem",
          "schema": {
            "$ref": "#/backend/entities/Problem"
          },
          "description": "Stores problems solved by the user. Only accessible by the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "problemId",
              "description": "The unique identifier of the problem."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to store user activity and problem-solving data for the StudyTrack Journal application. The structure prioritizes authorization independence and simplifies security rules by using path-based ownership for user-specific data.  All user-related data is stored under the `/users/{userId}` path to enforce strict ownership. This eliminates the need for complex `get()` calls in security rules and enables atomic operations.  Specifically:\n\n1.  **Users Collection:**  The `/users/{userId}` collection stores user profile information. Authentication relies on `request.auth.uid`. User documents are only accessible by the authenticated user.\n\n2.  **Activities Collection:** The `/users/{userId}/activities/{activityId}` collection stores activities logged by the user. The `userId` parameter enforces ownership, ensuring that only the authenticated user can access their activity data.  This design follows a hierarchical path for user-owned data, making security rules simple and efficient. The QAP for listing activities is supported because each activity is scoped to the user's path.\n\n3.  **Problems Collection:** Similar to activities, the `/users/{userId}/problems/{problemId}` collection stores problems solved by the user.  The `userId` parameter guarantees that only the authenticated user can access their problem data.  The QAP for listing problems is supported due to path-based scoping of the problems to each user.\n\nThis structure avoids mixing data with different access needs in the same collection (structural segregation). All data within a user's path is private and accessible only to that user. This drastically simplifies security rules and ensures data privacy. The schema also supports clear state modeling and predictable schemas, contributing to maintainability and debuggability."
  }
}