
{
  "entities": {
    "JournalEntry": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "JournalEntry",
      "type": "object",
      "description": "Represents a journal entry for a student's daily activities and problem-solving.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the journal entry."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N JournalEntry)"
        },
        "date": {
          "type": "string",
          "description": "The date of the journal entry.",
          "format": "date-time"
        },
        "summary": {
          "type": "string",
          "description": "A brief summary of the day's activities and accomplishments."
        },
        "activities": {
          "type": "array",
          "description": "References to activities performed during the day. (Relationship: JournalEntry 1:N Activity)",
          "items": {
            "type": "string"
          }
        },
        "problemsSolved": {
          "type": "array",
          "description": "References to problems solved during the day. (Relationship: JournalEntry 1:N Problem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "date"
      ]
    },
    "Activity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Activity",
      "type": "object",
      "description": "Represents a specific activity performed by the student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the activity."
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to JournalEntry. (Relationship: JournalEntry 1:N Activity)"
        },
        "type": {
          "type": "string",
          "description": "The type of activity (e.g., study session, class, break)."
        },
        "startTime": {
          "type": "string",
          "description": "The start time of the activity.",
          "format": "date-time"
        },
        "endTime": {
          "type": "string",
          "description": "The end time of the activity.",
          "format": "date-time"
        },
        "description": {
          "type": "string",
          "description": "A description of the activity."
        }
      },
      "required": [
        "id",
        "journalEntryId",
        "type",
        "startTime",
        "endTime"
      ]
    },
    "Problem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Problem",
      "type": "object",
      "description": "Represents a problem solved by the student.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the problem."
        },
        "journalEntryId": {
          "type": "string",
          "description": "Reference to JournalEntry. (Relationship: JournalEntry 1:N Problem)"
        },
        "category": {
          "type": "string",
          "description": "The category of the problem (e.g., Math, Physics, Chemistry)."
        },
        "response": {
          "type": "string",
          "description": "The student's response to the problem."
        }
      },
      "required": [
        "id",
        "journalEntryId",
        "category",
        "response"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "The user's display name."
        }
      },
      "required": [
        "id",
        "email",
        "name"
      ]
    },
    "Todo": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Todo",
      "type": "object",
      "description": "Represents a to-do item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the to-do item."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who owns this to-do."
        },
        "title": {
          "type": "string",
          "description": "The content of the to-do item."
        },
        "completed": {
          "type": "boolean",
          "description": "Whether the to-do item is completed."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the to-do was created."
        },
        "dueDate": {
          "type": "string",
          "format": "date",
          "description": "The due date for the to-do item."
        }
      },
      "required": ["id", "userId", "title", "completed", "createdAt"]
    }
  },
  "auth": {
    "providers": [
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The 'userId' parameter identifies the user. Only the user can read/write their profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/journalEntries/{journalEntryId}",
        "definition": {
          "entityName": "JournalEntry",
          "schema": {
            "$ref": "#/backend/entities/JournalEntry"
          },
          "description": "Stores journal entries for each user. The 'userId' parameter identifies the owner of the journal entry. Only the user can read/write their journal entries.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "journalEntryId",
              "description": "The unique identifier of the journal entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/journalEntries/{journalEntryId}/activities/{activityId}",
        "definition": {
          "entityName": "Activity",
          "schema": {
            "$ref": "#/backend/entities/Activity"
          },
          "description": "Stores activities associated with a specific journal entry. The 'userId' parameter ensures only the user can read/write their activities.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "journalEntryId",
              "description": "The unique identifier of the journal entry."
            },
            {
              "name": "activityId",
              "description": "The unique identifier of the activity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/journalEntries/{journalEntryId}/problems/{problemId}",
        "definition": {
          "entityName": "Problem",
          "schema": {
            "$ref": "#/backend/entities/Problem"
          },
          "description": "Stores problems solved associated with a specific journal entry. The 'userId' parameter ensures only the user can read/write their problems.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "journalEntryId",
              "description": "The unique identifier of the journal entry."
            },
            {
              "name": "problemId",
              "description": "The unique identifier of the problem."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/todos/{todoId}",
        "definition": {
          "entityName": "Todo",
          "schema": {
            "$ref": "#/backend/entities/Todo"
          },
          "description": "Stores to-do items for each user. The 'userId' parameter ensures only the user can access their own to-dos.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "todoId",
              "description": "The unique identifier of the to-do item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to securely store journal entries, activities, and problems solved by students using path-based ownership. This approach ensures data isolation and simplified security rules.\n\n*   **Authorization Independence:** Each journal entry, activity, and problem is stored under the user's document. Therefore, authorization rules can be written based on the `request.auth.uid` without needing to read any other documents.\n*   **Structural Segregation:** Data is segregated based on ownership, enhancing security. Journal entries, activities, and problems are stored in separate subcollections under each user's document, which avoids mixing data with different access requirements in the same collection.\n*   **Access Modeling:** Path-based ownership (`/users/{userId}/journalEntries/{journalEntryId}`) is used, which is straightforward and secure. Activities and problems are stored in subcollections of journal entries to represent the `JournalEntry 1:N Activity` and `JournalEntry 1:N Problem` relationships, while maintaining the correct access control.\n*   **QAPs:** Because the structure is path-based and access is granted based on the user ID in the path, listing operations can be secured by checking that `request.auth.uid` matches the `userId` in the path. This prevents unauthorized listing of other users' data."
  }
}
